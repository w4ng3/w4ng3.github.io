---
title: 自定义抽象组件
icon: vue
date: 2022-07-31
author: 王東
category:
  - Vue
tag:
  - 吃饱撑的
order: 14
---

诸如 `<keep-alive>`、`<transition>`、`<transition-group>` 和 `<teleport>` 等组件是 Vue 的内置组件，也可称为抽象组件，组件的实现是一个对象。

> Vue 的文档没有提这个概念，在抽象组件的生命周期过程中，我们可以对包裹的子组件监听的事件进行拦截，也可以对子组件进行 Dom 操作，从而可以对我们需要的功能进行封装，而不需要关心子组件的具体实现。

## 实现一个 debounce 组件，对子组件的 click 事件进行拦截

防抖依靠 lodash.js 的 debounce（防抖动）函数来实现

```
$ pnpm add --save lodash
```

:::tip
节流: n 秒内只运行一次，若在 n 秒内重复触发，只有一次生效  
防抖: n 秒后在执行该事件，若在 n 秒内被重复触发，则重新计时
:::
接下来是将它封装为一个抽象组件
::: code-tabs#language
@tab debounce.js

```js
import { defineComponent } from "vue";
import { get, debounce, set } from "lodash";

export default defineComponent({
  name: "debounce",
  abstract: true, //标记为抽象组件

  render() {
    let vnode = this.$slots.default()[0]; // 子组件的vnode
    console.log("子组件的vnode", vnode);
    if (vnode) {
      let event = get(vnode, `props.onClick`); // 子组件绑定的click事件
      console.log("event", event);
      if (typeof event === "function") {
        set(vnode, `props.onClick`, debounce(event, 1000));
      }
    }
    return vnode;
  },
});
```

@tab Abstract.vue

```vue
<template>
  <div>
    <h1>自定义抽象组件</h1>
    <debounce>
      <NButton type="primary" @click="++count">防抖计数: {{ count }}</NButton>
    </debounce>
    <hr />
    <NButton type="error" @click="++count">普通计数: {{ count }}</NButton>
  </div>
</template>
<script setup>
import { ref } from "vue";
import debounce from "../components/debounce";
const count = ref(0);
</script>
```

:::
![防抖](https://riddler.oss-cn-shanghai.aliyuncs.com/blog/debounce.gif)
如上图所示，被防抖组件包裹的节点，无论连续点击多少次，都只在结束点击的一秒后触发一次
<img
  src="https://riddler.oss-cn-shanghai.aliyuncs.com/blog/20220731175122.png"
  alt="子组件的vnode"
  width="400"
  height="341"
/>

## 参考

- [用 Vue 编写抽象组件](https://juejin.cn/post/6844903838470635528)
- [什么是防抖和节流？](https://vue3js.cn/interview/JavaScript/debounce_throttle.html#%E9%9D%A2%E8%AF%95%E5%AE%98-%E4%BB%80%E4%B9%88%E6%98%AF%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0)
